!function(){"use strict";function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function e(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)),o}function a(s){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?e(Object(a),!0).forEach(function(t){var e,n,o;e=s,o=a[n=t],n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(a,t))})}return s}var t,n=new(function(){function o(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.canvas="string"==typeof t?document.querySelector(t):t,this.ctx=this.canvas.getContext("2d"),this.on=!1,this.lastX=0,this.lastY=0,this.pathArr=[],this.step=-1;var n=a({lineCap:"round",lineWidth:2,lineColor:"#000000",adjustAngel:4},e);this.d3Line=d3.line().x(function(t){return t.x}).y(function(t){return t.y}).curve(d3.curveCardinal),this.d3Line.context(this.ctx),this.init(n)}var t,e,n;return t=o,(e=[{key:"init",value:function(t){var l=this,e=t.lineCap,n=t.lineWidth,o=t.lineColor,s=t.adjustAngel,h=t.scrollEl;this.ctx.lineCap=e,this.ctx.lineWidth=n,this.ctx.strokeStyle=o,this.adjustAngel=s;function a(t){var e="touchstart"===t.type,n=e&&t.changedTouches&&t.changedTouches[0],o=h?h.scrollLeft:window.scrollX,s=h?h.scrollTop:window.scrollY;console.log(t,n),l.on=!0,u=l.lastX=e?n.clientX-n.target.offsetLeft+o:t.offsetX,f=l.lastY=e?n.clientY-n.target.offsetTop+s:t.offsetY,console.log(u,f),d=[{x:u,y:f}]}function r(t){var e,n,o,s,a,r,i,c;l.on&&((e="touchmove"===t.type)&&t.preventDefault(),n=e&&t.changedTouches&&t.changedTouches[0],o=h?h.scrollLeft:window.scrollX,s=h?h.scrollTop:window.scrollY,a=e?n.clientX-n.target.offsetLeft+o:t.offsetX,r=e?n.clientY-n.target.offsetTop+s:t.offsetY,l.draw(a,r),i=180*Math.atan2(u,f)/Math.PI,c=180*Math.atan2(a,r)/Math.PI,Math.abs(i-c)>l.adjustAngel&&(u=a,f=r,d.push({x:u,y:f})))}function i(t){var e,n,o,s,a,r;l.on&&(n=(e="touchend"===t.type)&&t.changedTouches&&t.changedTouches[0],o=h?h.scrollLeft:window.scrollX,s=h?h.scrollTop:window.scrollY,a=e?n.clientX-n.target.offsetLeft+o:t.offsetX,r=e?n.clientY-n.target.offsetTop+s:t.offsetY,l.on=!1,l.addPath(),d.push({x:a,y:r}),l.adjustCurve(d))}var u,f,d=[];this.canvas.onmousedown=a,this.canvas.onmousemove=r,this.canvas.onmouseup=i,this.canvas.ontouchstart=a,this.canvas.ontouchmove=r,this.canvas.ontouchend=i,this.canvas.onmouseleave=i,this.addPath()}},{key:"draw",value:function(t,e){this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(t,e),this.ctx.stroke(),this.lastX=t,this.lastY=e}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}},{key:"addPath",value:function(){this.step++,this.step<this.pathArr.length&&(this.pathArr.length=this.step),this.pathArr.push(this.canvas.toDataURL())}},{key:"undo",value:function(){var o=this;return new Promise(function(t,e){var n;0<o.step?(o.step--,(n=new Image).src=o.pathArr[o.step],n.onload=function(){o.clear(),o.ctx.drawImage(n,0,0),t(1)}):e(0)})}},{key:"redo",value:function(){var o=this;return new Promise(function(t,e){var n;o.step<o.pathArr.length-1?(o.step++,(n=new Image).src=o.pathArr[o.step],n.onload=function(){o.clear(),o.ctx.drawImage(n,0,0),t(1)}):e(0)})}},{key:"setLineColor",value:function(t){this.ctx.strokeStyle=t}},{key:"setLineWidth",value:function(t){this.ctx.lineWidth=t}},{key:"setAdjustAngel",value:function(t){this.adjustAngel=t}},{key:"adjustCurve",value:function(t){var e=this;this.undo().then(function(){e.d3Line(t),e.ctx.stroke(),e.addPath()})}}])&&s(t.prototype,e),n&&s(t,n),o}())("#canvas");t="#adjustAngel",document.querySelector(t).addEventListener("change",function(t){n.adjustAngel=~~t.target.value})}();
