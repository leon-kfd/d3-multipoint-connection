!function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(t,n){Object.keys(n).map(function(e){t.setAttribute(e,n[e])})}function t(e){return document.querySelector(e)}var n=new(function(){function t(e){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.el=e,this.movingCircleEl=this.el.querySelector(".fake-point"),this.centerPoint={x:300,y:300},this.index=0,this.R=5,this.lineType="curveCardinal",this.lineTypeControlValue=0,this.lineTypeControlMap={curveBundle:{name:"beta",default:.85},curveCardinal:{name:"tension",default:0},curveCatmullRom:{name:"alpha",default:.5}},this.moveTarget=null,this.isDraging=!1,this.el.addEventListener("mousedown",function(e){var t=e.target;t.dataset.point&&(i.moveTarget=t,a(i.movingCircleEl,{cx:t.getAttribute("cx"),cy:t.getAttribute("cy")}),i.movingCircleEl.classList.remove("hidden"),i.isDraging=!0)}),this.el.addEventListener("mousemove",function(e){var t,n;i.isDraging&&(t=e.offsetX,n=e.offsetY,a(i.movingCircleEl,{cx:t,cy:n}))}),this.el.addEventListener("mouseup",function(e){i.isDraging=!1,i.movingCircleEl.classList.add("hidden");var t=e.offsetX,n=e.offsetY;i.moveTarget&&(a(i.moveTarget,{cx:t,cy:n}),a(i.moveTarget.nextElementSibling,{x:t,y:n+i.R+15}),i.linkPoint()),i.moveTarget=null})}var e,n,i;return e=t,(n=[{key:"setLineType",value:function(e){var t=this;this.lineType=e;var n=Object.keys(this.lineTypeControlMap).find(function(e){return t.lineType.includes(e)});n&&(this.lineTypeControlValue=this.lineTypeControlMap[n].default),this.linkPoint()}},{key:"setLineTypeControlValue",value:function(e){this.lineTypeControlValue=e,this.linkPoint()}},{key:"addRandomPoint",value:function(e){var t=0<arguments.length&&void 0!==e?e:500,n=this.centerPoint.x+(Math.random()-.5)*t,i=this.centerPoint.y+(Math.random()-.5)*t;this.addPoint(n,i)}},{key:"addPoint",value:function(e,t){var n=++this.index,i=document.createElementNS("http://www.w3.org/2000/svg","circle");a(i,{cx:e,cy:t,r:this.R,fill:"#262626",id:"_point".concat(n),class:"point","data-point":n}),this.el.appendChild(i);var r=document.createElementNS("http://www.w3.org/2000/svg","text");a(r,{x:e,y:t+this.R+15,"text-anchor":"middle","font-size":12}),r.textContent=n,this.el.appendChild(r),this.linkPoint()}},{key:"linkPoint",value:function(){var e,t=o(document.querySelectorAll("[data-point]")).map(function(e){return{x:~~e.getAttribute("cx"),y:~~e.getAttribute("cy")}});t.length<=2||(e=this.getCurrentCurve(),d3.select("#line").datum(t).attr("d",d3.line().x(function(e){return e.x}).y(function(e){return e.y}).curve(e)))}},{key:"getCurrentCurve",value:function(){var t=this,e=Object.keys(this.lineTypeControlMap).find(function(e){return t.lineType.includes(e)});return e?d3[this.lineType][this.lineTypeControlMap[e].name](this.lineTypeControlValue):d3[this.lineType]}}])&&r(e.prototype,n),i&&r(e,i),t}())(t("#main"));function l(){var e=Object.keys(n.lineTypeControlMap).find(function(e){return n.lineType.includes(e)});e?(t("#lineTypeControlWrapper").classList.remove("hidden"),t("#lineTypeControlValue").value=n.lineTypeControlValue,t("#lineTypeControlLabel").innerText=n.lineTypeControlMap[e].name):t("#lineTypeControlWrapper").classList.add("hidden")}n.addPoint(300,150),n.addPoint(150,450),n.addPoint(450,450),l(),t("#add").addEventListener("click",function(){n.addRandomPoint()}),t("#lineType").addEventListener("change",function(e){n.setLineType(e.target.value),l()}),t("#lineTypeControlValue").addEventListener("change",function(e){n.setLineTypeControlValue(e.target.value)})}();
